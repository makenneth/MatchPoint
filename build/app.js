"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _path=require("path"),_path2=_interopRequireDefault(_path),_expressMinify=require("express-minify"),_expressMinify2=_interopRequireDefault(_expressMinify),_mongoose=require("mongoose"),_mongoose2=_interopRequireDefault(_mongoose),_nodeSassMiddleware=require("node-sass-middleware"),_nodeSassMiddleware2=_interopRequireDefault(_nodeSassMiddleware),_cookieParser=require("cookie-parser"),_cookieParser2=_interopRequireDefault(_cookieParser),_express=require("express"),_express2=_interopRequireDefault(_express),_app_modules=require("./helpers/app_modules"),_players=require("./api/players"),_players2=_interopRequireDefault(_players),_club=require("./api/club"),_club2=_interopRequireDefault(_club),_session=require("./api/session"),_session2=_interopRequireDefault(_session),_pdf=require("./api/pdf"),_pdf2=_interopRequireDefault(_pdf),_webpack=require("webpack"),_webpack2=_interopRequireDefault(_webpack),_webpackDevMiddleware=require("webpack-dev-middleware"),_webpackDevMiddleware2=_interopRequireDefault(_webpackDevMiddleware),_webpackConfig=require("../webpack.config.js"),_webpackConfig2=_interopRequireDefault(_webpackConfig),port=3e3,compiler=(0,_webpack2.default)(_webpackConfig2.default);_app_modules.app.set("view engine","ejs"),_app_modules.app.set("views",_path2.default.join(__dirname,"..","public","views")),_mongoose2.default.connect("mongodb://localhost/roundrobindb"),_app_modules.app.use((0,_cookieParser2.default)()),_app_modules.app.use("/favicon.ico",function(e,p,a){p.end()}),_app_modules.app.use((0,_nodeSassMiddleware2.default)({src:_path2.default.join(__dirname,"assets","sass"),dest:_path2.default.join(__dirname,"..","public","styles"),prefix:"/styles",debug:!0})),_app_modules.app.use(_express2.default.static(_path2.default.join(__dirname,"..","public"),{maxAge:2e7})),_app_modules.app.use((0,_webpackDevMiddleware2.default)(compiler)),_app_modules.app.use("/api/clubs",_club2.default),_app_modules.app.use("/api/clubs",_players2.default),_app_modules.app.use("/api/pdfs",_pdf2.default),_app_modules.app.use("/api/*",function(e,p,a){p.status(404).send("Invalid routes"),p.end()}),_app_modules.app.use("/session",_session2.default),_app_modules.app.use("/*",function(e,p,a){var s=e.originalUrl;console.log(s);var i,r=s.match(/^(\/$|\/login|\/signup)/);_app_modules.clubMethods.currentClub(e).then(function(e){i=e}).catch(function(e){i=null}).then(function(){i&&r?(console.log("redirecting"),p.redirect("/club"),p.end()):a()})}),_app_modules.app.get("*",_app_modules.csrfProtection,function(e,p){p.render("index",{csrfToken:e.csrfToken()})}),_app_modules.app.listen(port,function(){console.log("listening on port 80...")});
